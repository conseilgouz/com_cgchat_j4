var cgchat={debug:!0,abort_time_extra:6e3,sids:[],mostrar_colores_iniciado:!1,private:!1,retardo_avisar:!1,shift_pressed:!1,shift_priv_pressed:!1,popup:null,popup_smileys:null,scrolling:!1,scrolling_privados:!1,starting:!1,$:function(t){return document.getElementById(t)},defined:function(t){return void 0!==t},css:function(t,e,s){if(this.checkID(t))return this.defined(s)?void(this.$(t).style[e]=s):this.$(t).style[e]},attr:function(t,e,s){if(this.checkID(t))return this.defined(s)?void(this.$(t)[e]=s):this.$(t)[e]},val:function(t,e){if(this.checkID(t))return this.defined(e)?void(this.$(t).value=e):this.$(t).value},html:function(t,e){if(this.checkID(t))return this.defined(e)?void(this.$(t).innerHTML=e):this.$(t).innerHTML},show:function(t,e){this.checkID(t)&&(e=this.defined(e)?e?"":"none":"none"==this.css(t,"display")?"":"none",this.css(t,"display",e))},toggle:function(t){this.checkID(t)&&(s=this.css(t,"display"),this.defined(s)&&""!=s?this.css(t,"display",""):this.css(t,"display","none"))},visible:function(t,e){this.checkID(t)&&(e=this.defined(e)?e?"":"hidden":"hidden"==this.css(t,"visibility")?"":"hidden",this.css(t,"visibility",e))},foco:function(t){this.checkID(t)&&this.$(t).focus()},checkID:function(t){if(this.$(t))return!0;this.debug&&this.error("The element with id '"+t+"' doesn't exists.",2)},log:function(t,e,s){this.debug&&console&&console.log&&console.log("CG Chat error: "+t+" at "+e+":"+s)},error:function(t,e,s){try{var i=0;if(!this.defined(s)){i++;s=new Error}if(-1!=(a=s.stack).indexOf("@")){var o=(a=a.split("\n")[e+i].split("@")[1].split(":"))[a.length-1];a[a.length-1]="";var r=(a=a.join(":")).substr(0,a.length-1);this.log(t,r,o)}else if(-1!=a.indexOf("at ")){var a;o=(a=a.split("\n")[e+i].match(/\(([^\)]+)/)[1].split(":"))[a.length-2];a[a.length-1]="",a[a.length-2]="";r=(a=a.join(":")).substr(0,a.length-2);this.log(t,r,o)}}catch(t){}},form:function(t,e){if(void 0===e)return document.forms.kideForm[t].value;document.forms.kideForm[t].value=e},onLoad:function(t,e){window.addEventListener?window.addEventListener("load",t,!1):window.attachEvent?window.attachEvent("onload",t):cgchat.defined(e)?e():t()},addHTMLInBody:function(t){this.onLoad((function(){var e=document.createElement("div");e.setAttribute("class","CGCHAT_div"),e.innerHTML=t,cgchat.insertAfter(e,document.body.lastChild)}),(function(){document.write(t)}))},start:function(){cgchat.starting||(cgchat.starting=!0,cgchat.attr("starting","src",cgchat.img_starting[2]),cgchat.sessions(),cgchat.reload(),cgchat.events.fire("onstart"))},open_popup:function(){this.popup&&this.popup.close(),this.popup=window.open(this.popup_url,"_blank","toolbar=0,location=0,menubar=0,directories=0,resizable=1,scrollbars=1,width=800,height=600")},open_popup_smileys:function(t){this.popup_smileys&&this.popup_smileys.close();var e="menubar=0,resizable=1,location=0,status=0,scrollbars=1";t&&t.length>0&&(e+=","+t),this.popup_smileys=window.open(this.ajax_url+"&task=more_smileys&window=1","_blank",e)},text:function(t){return cgchat.defined(t.textContent)?t.textContent:t.text},reload:function(){cgchat.ajax("reload")},getUser:function(t){return this.defined(this.sids[t])?this.sids[t]:null},getUserById:function(t){for(var e in this.sids)if(this.sids[e].id==t)return this.sids[e]},sessions:function(){cgchat.ajax("sessions")},sonido:function(){-1!=this.sound&&(1==this.sound?(this.sound=0,this.attr("sound","src",this.sound_off)):(this.sound=1,this.attr("sound","src",this.sound_on),this.play_msg_sound()),this.save_config("sound",this.sound))},save_config:function(param,value){var config=document.cookie.match(/cgchat_config=([^;]*)/);config&&config[1]?(config=decodeURIComponent(config[1]),config.search(eval("/"+param+"=/"))>-1?config=config.replace(eval("/"+param+"=[^;]*/"),param+"="+value):config+=";"+param+"="+value):config=param+"="+value,issecure="","https:"==window.location.protocol&&(issecure="secure;"),document.cookie="cgchat_config="+encodeURIComponent(config)+"; path=/;samesite=lax;"+issecure},ahora:function(){var t=new Date,e=t.getMonth()+1;return t=t.getDate()+"-"+(e<10?"0":"")+e+" "+t.getHours()+":"+(t.getMinutes()<10?"0":"")+t.getMinutes()+":"+(t.getSeconds()<10?"0":"")+t.getSeconds()},in_array:function(t,e){for(var s=0;s<e.length;s++)if(e[s]==t)return!0;return!1},insertAfter:function(t,e){var s=e.parentNode;s.lastchild==e?s.appendChild(t):s.insertBefore(t,e.nextSibling)},trim:function(t,e){var s,i=0,o=0;for(t+="",s=e?(e+="").replace(/([\[\]\(\)\.\?\/\*\{\}\+\$\^\:])/g,"$1"):" \n\r\t\f\v            ​\u2028\u2029　",i=t.length,o=0;o<i;o++)if(-1===s.indexOf(t.charAt(o))){t=t.substring(o);break}for(o=(i=t.length)-1;o>=0;o--)if(-1===s.indexOf(t.charAt(o))){t=t.substring(0,o+1);break}return-1===s.indexOf(t.charAt(0))?t:""},htmlspecialchars_decode:function(t,e){var s=0,i=0,o=!1;void 0===e&&(e=2),t=t.toString().replace(/&lt;/g,"<").replace(/&gt;/g,">");var r={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(0===e&&(o=!0),"number"!=typeof e){for(e=[].concat(e),i=0;i<e.length;i++)0===r[e[i]]?o=!0:r[e[i]]&&(s|=r[e[i]]);e=s}return e&r.ENT_HTML_QUOTE_SINGLE&&(t=t.replace(/&#0*39;/g,"'")),o||(t=t.replace(/&quot;/g,'"')),t=t.replace(/&amp;/g,"&")},check_shift:function(t,e,s){var i=this.getCode(t);e?16==i&&(s?this.shift_priv_pressed=!1:this.shift_pressed=!1):13!=i&&(s?this.shift_priv_pressed=16==i:this.shift_pressed=16==i)},getCode:function(t){return t.keyCode?t.keyCode:t.which?t.which:t.charCode},isEnter:function(t){return 13==this.getCode(t)},pressedEnter:function(t,e){return!this.isEnter(t)||(!!(!e&&this.shift_pressed||e&&this.shift_priv_pressed)||(e?this.ajax("privados_insertar"):this.sm(),!1))},tiempo:function(t){if((t=Number(t))<=0)cgchat.private?cgchat.show("CGCHAT_tiempo_p",!1):cgchat.show("CGCHAT_tiempo_n",!1);else{cgchat.private?cgchat.show("CGCHAT_tiempo_p",!0):cgchat.show("CGCHAT_tiempo_n",!0),t-=this.retardo;var e=new Date;e=e.getTime(),(t=Math.floor(e/1e3-t))<=0&&(t=1);var s,i="",o=!1,r=new Array;for(r[0]=new Array,r[0][0]=Math.floor(t/2592e3),r[0][1]=Math.floor((t-2592e3*r[0][0])/86400),r[0][2]=Math.floor((t-2592e3*r[0][0]-86400*r[0][1])/3600),r[0][3]=Math.floor((t-2592e3*r[0][0]-86400*r[0][1]-3600*r[0][2])/60),r[0][4]=Math.floor(t-62592e3*r[0][0]-86400*r[0][1]-3600*r[0][2]-60*r[0][3]),r[1]=[1,3,7,10],s=0;s<=4&&!o;s++)r[0][s]&&(o=!0,i+=r[0][s]+" "+this.msg.lang[1!=r[0][s]?2*s+1:2*s],s<4&&r[0][s]<=r[1][s]&&r[0][s+1]&&(i+=" "+r[0][s+1]+" "+this.msg.lang[1!=r[0][s+1]?2*(s+1)+1:2*(s+1)]));i||(i="1 "+this.msg.lang[8]),cgchat.private?cgchat.html("CGCHAT_tiempo_p_K",i):cgchat.html("CGCHAT_tiempo_n_K",i)}},insertSmile:function(t){cgchat.insertAtCursor(document.forms.kideForm.txt,t)},insertAtCursor:function(t,e){var s=t,i=s.scrollTop,o=0,r=s.selectionStart||"0"==s.selectionStart?"ff":!!document.selection&&"ie";"ie"==r?(s.focus(),(a=document.selection.createRange()).moveStart("character",-s.value.length),o=a.text.length):"ff"==r&&(o=s.selectionStart);var a,n=s.value.substring(0,o),c=s.value.substring(o,s.value.length);(s.value=n+e+c,o+=e.length,"ie"==r)?(s.focus(),(a=document.selection.createRange()).moveStart("character",-s.value.length),a.moveStart("character",o),a.moveEnd("character",0),a.select()):"ff"==r&&(s.selectionStart=o,s.selectionEnd=o,s.focus());s.scrollTop=i},filter_smilies:function(t){t=" "+t+" ";for(var e=0;e<this.smilies.length;e++)t=(t=t.replace(" "+this.smilies[e][0],'<img alt="'+this.smilies[e][0]+'" title="'+this.smilies[e][0]+'" src="'+this.smilies[e][1]+'" class="CGCHAT_icono" />')).replace(" "+this.smilies[e][0].toLowerCase(),'<img alt="'+this.smilies[e][0]+'" title="'+this.smilies[e][0]+'" src="'+this.smilies[e][1]+'" class=CGCHAT_icono" />');return t},tohtml:function(t){return t=(t=(t=(t=(t=t.replace(/&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&#39;")).replace(/"/g,"&quot;")},hasClass:function(t,e){var s=new RegExp("(?:\\s|^)"+e+"(?:\\s|$)");return!!t.className.match(s)},addClass:function(t,e){t.className+=" "+e},removeClass:function(t,e){let s=new RegExp("(?:\\s|^)"+e+"(?:\\s|$)");t.className=t.className.replace(s," ")},sm:function(){cgchat.ajax("insertar"),cgchat.starting||cgchat.start()},retardo_input:function(){this.retardo_avisar=!0,this.ajax("retardo")},mostrar_iconos:function(){this.$("CGCHAT_iconos")&&(this.save_config("icons_hidden","none"==this.css("CGCHAT_iconos","display")?0:1),this.show("CGCHAT_iconos"))},play_msg_sound:function(){this.html("CGCHAT_msg_sound",'<audio autoplay style="height:0;width:0"><source src="'+this.sound_src+'" type="audio/mpeg"></audio>')},mostrar_opciones:function(){this.mostrar_colores_iniciado||(this.mostrar_colores_iniciado=!0,this.show_colors()),this.show("CGCHAT_opciones")},save_options:function(){this.show("CGCHAT_opciones",!1),this.color&&this.save_config("color",this.color),this.save_config("hidden_session",this.attr("hidden_session","checked")?1:0),this.form("CGCHAT_template")!=this.template&&(this.save_config("template",this.form("CGCHAT_template")),location.reload())},set_color:function(t){this.can_write&&(this.color=t,this.css("CGCHAT_txt","color","#"+t),this.events.fire("onSetColor",t))},set_private:function(t){this.private=t,this.show("CGCHAT_GOCHAT",!1),this.show("waiting_private",!1);let e=document.querySelectorAll("#CGCHAT_users div");for(var s=0;s<e.length;s++)attr=e[s].getAttribute("data"),attr!=t||this.hasClass(e[s],"private")||this.addClass(e[s],"private");this.show("CGCHAT_msgs",!1),this.show("CGCHAT_msgs_private",!0),this.show("private_txt",!0)},reset_private:function(){this.private=0,this.show("waiting_private",!1);let t=document.querySelectorAll("#CGCHAT_users div");for(var e=0;e<t.length;e++)this.removeClass(t[e],"private");this.show("CGCHAT_msgs",!0),this.show("CGCHAT_msgs_private",!1),this.show("private_txt",!1)},ask_private:function(t){this.ajax("ask_private",[t,document.getElementById("CGCHAT_user_go_to_private").checked])},close_private:function(){this.ajax("close_private")},accept_private:function(t){t?this.ajax("accept_private"):this.ajax("close_private")},clean_private:function(){this.$("CGCHAT_output_private").remove();var t=document.createElement("div");t.setAttribute("id","CGCHAT_output_private"),t.innerHTML="<span></span>",msgs=this.$("CGCHAT_msgs_private"),pos=this.$("CGCHAT_tiempo_p"),"bottom"==this.order?msgs.insertBefore(t,pos):this.insertAfter(t,pos),this.p=0},borrar:function(t){t>0?(this.show("CGCHAT_id_"+t,!1),this.show("CGCHAT_mensaje",!1),this.ajax("borrar",t)):alert(this.msg.mensaje_borrar)},getDocumentWidth:function(){return window.innerWidth?window.innerWidth:document.documentElement.clientWidth},getDocumentHeight:function(){return window.innerHeight?window.innerHeight:document.documentElement.clientHeight},banear:function(t,e){this.ajax("ban",[t,document.getElementById("CGCHAT_user_banear").checked])},ajax:function(t,e){var s=new XMLHttpRequest;if("reload"==t)lastid=this.n,cgchat.private&&(lastid=this.p),url=this.ajax_url+"&task=reload&privs="+cgchat.private+"&id="+lastid+"&token="+this.token+"&format=json",setTimeout((function(){s.abort()}),cgchat.refresh_time+cgchat.abort_time_extra),Joomla.request({method:"POST",url:url,onSuccess:function(t,e){var s=JSON.parse(t);if(s.privaterequest&&(user=cgchat.getUserById(s.privaterequest),user&&(cgchat.show("CGCHAT_GOCHAT",!0),msg=cgchat.html("CGCHAT_GOCHAT"),msg=msg.replace("%s",user.name),cgchat.html("CGCHAT_GOCHAT",msg))),s.private?cgchat.set_private(s.private):cgchat.reset_private(),s.last_id){s.private?cgchat.p=s.last_id:cgchat.n=s.last_id,cgchat.last_time=s.last_time;for(var i=0;i<s.messages.length;i++)row=s.messages[i],cgchat.insertNewContent(row.uid,row.name,row.text,row.url,row.date,row.color,row.row,row.id,row.session,row.session==cgchat.session,row.hora,row.img,cgchat.private);cgchat.ajustar_scroll(cgchat.private)}cgchat.events.fire("onAjaxReload",s),cgchat.tiempo(cgchat.last_time),setTimeout(cgchat.reload,cgchat.refresh_time)},onError:function(t){console.log(t.responseText)}});else if("insertar"==t){var i=this.val("CGCHAT_txt");if(cgchat.val("CGCHAT_txt",""),!cgchat.trim(i))return;this.visible("CGCHAT_img_ajax",!0),urltxt=encodeURIComponent(i),urltxt=urltxt.replaceAll("%0A"," ~ ").replaceAll("%3A",":").replaceAll("%2F","@").replaceAll(/'/g,"\\x27"),urltxt=urltxt.replaceAll("%3E","").replaceAll("%3C",""),color="",this.color&&(color="&color="+this.color),url=this.ajax_url+"&task=add&privs="+cgchat.private+"&txt="+urltxt+"&"+this.token+"=1&format=json"+color,Joomla.request({method:"POST",url:url,onSuccess:function(t,e){var s=JSON.parse(t);if(1!=s.banned){if(s.comment){var o=s.comment;cgchat.insertNewContent(0,"System",o,"",cgchat.ahora(),"",0,0,0,!1,s.hora,"",cgchat.private)}if(s.txt&&s.txt.length){o=s.txt;cgchat.insertNewContent(cgchat.userid,cgchat.name,o.length?o:i,cgchat.url,cgchat.ahora(),cgchat.color,cgchat.row,s.id,cgchat.session,!0,s.hora,s.img,cgchat.private),cgchat.private?cgchat.p=s.id:cgchat.n=s.id,cgchat.last_time=s.tiempo,cgchat.tiempo(cgchat.last_time),cgchat.ajustar_scroll(cgchat.private)}cgchat.visible("CGCHAT_img_ajax",!1),cgchat.events.fire("onAjaxInsertar",s)}else location.reload()},onError:function(t){console.log(t.responseText)}})}else"ask_private"==t?(url=this.ajax_url+"&task=askprivate&user="+e[0]+"&private="+e[1]+"&"+this.token+"=1&format=json",cgchat.show("waiting_private",!0),Joomla.request({method:"POST",url:url,onSuccess:function(t,e){var s=JSON.parse(t);s.error?(console.log(s.error),cgchat.html("CGCHAT_user_to_private_error",s.error),cgchat.show("CGCHAT_user_to_private_error",!0),cgchat.attr("CGCHAT_user_go_to_private","checked",""),cgchat.show("waiting_private",!1)):(cgchat.show("CGCHAT_user_to_private_error",!1),cgchat.clean_private())},onError:function(t){console.log(t.responseText)}})):"close_private"==t?(url=this.ajax_url+"&task=closeprivate&user="+cgchat.userid+"&"+this.token+"=1&format=json",Joomla.request({method:"POST",url:url,onSuccess:function(t,e){JSON.parse(t);cgchat.reset_private(),cgchat.show("waiting_private",!0),cgchat.clean_private(),cgchat.ajax("sessions")},onError:function(t){console.log(t.responseText)}})):"accept_private"==t?(url=this.ajax_url+"&task=acceptprivate&user="+cgchat.userid+"&"+this.token+"=1&format=json",cgchat.show("CGCHAT_GOCHAT",!1),Joomla.request({method:"POST",url:url,onSuccess:function(t,e){var s=JSON.parse(t);cgchat.set_private(s.private),cgchat.clean_private(),cgchat.show("waiting_private",!0),cgchat.ajax("sessions")},onError:function(t){console.log(t.responseText)}})):"borrar"==t?(url=this.ajax_url+"&task=borrar&id="+e+"&"+this.token+"=1&format=json",Joomla.request({method:"POST",url:url,onSuccess:function(t,e){},onError:function(t){console.log(t.responseText)}})):"sessions"==t?(url=this.ajax_url+"&task=sessions&show_sessions="+cgchat.show_sessions+"&privs="+(cgchat.hidden_session?0:1)+"&"+this.token+"=1&format=json",Joomla.request({method:"POST",url:url,onSuccess:function(t,e){var s=JSON.parse(t);if(cgchat.show_sessions){cgchat.sids=[],cgchat.html("CGCHAT_users",""),stillprivate=0;for(var i=s.length-1;i>=0;i--){row=s[i];var o=row.session;cgchat.userid>0&&row.userid==cgchat.userid&&row.private&&(user=cgchat.getUserById(row.private),cgchat.set_private(row.private),cgchat.show("waiting_private",!1),stillprivate=!0),row.userid>0&&row.userid==cgchat.userid&&(row.class+=" me"),row.userid>0&&row.userid==cgchat.private&&(row.class+=" private"),4==row.row&&(row.class+=" banned"),cgchat.sids[o]={row:row.row,name:row.name,_class:row.class,title:cgchat.rowtitles[row.row],session:row.session,profile:row.profile,private:row.private,id:row.userid,img:row.img},row.session==cgchat.session&&(4==row.row&&row.banned?(msg=cgchat.html("cgchat_banned"),msg=msg.replace("%s",row.banned),cgchat.html("cgchat_banned",msg),cgchat.show("cgchat_banned",!0),cgchat.show("CGCHAT_form",!1)):(cgchat.show("cgchat_banned",!1),cgchat.show("CGCHAT_form",!0),cgchat.show("CGCHAT_user",!1))),cgchat.events.fire("onAjaxSession",cgchat.getUser(o)),cgchat.insert_session(cgchat.getUser(o))}stillprivate||cgchat.reset_private()}setTimeout(cgchat.sessions,cgchat.refresh_time_session)},onError:function(t){console.log(t.responseText)}})):"retardo"==t?(url=this.ajax_url+"&task=retardo&"+this.token+"=1&format=json",Joomla.request({method:"POST",url:url,onSuccess:function(t,e){var s=JSON.parse(t).time;if(s>0){var i=new Date;i=i.getTime(),s-=Math.floor(i/1e3),cgchat.retardo=s,cgchat.save_config("retardo",cgchat.retardo),cgchat.retardo_avisar&&alert(cgchat.msg.retardo_frase.replace("%s",s))}},onError:function(t){console.log(t.responseText)}})):"ban"==t?(url=this.ajax_url+"&task=ban&session="+e[0]+"&flag="+e[1]+"&"+this.token+"=1&format=json",Joomla.request({method:"POST",url:url,onSuccess:function(t,e){JSON.parse(t);cgchat.show("CGCHAT_user",!1),cgchat.ajax("sessions")},onError:function(t){console.log(t.responseText)}})):"kill"==t?(url=this.ajax_url+"&task=kill&session="+cgchat.session+"&"+this.token+"=1&format=json",Joomla.request({method:"POST",url:url,onSuccess:function(t,e){},onError:function(t){console.log(t.responseText)}})):this.events.fire("onAjax_"+t,[s,e])},options:function(t){if(this.img_starting=t.img_starting,this.sound_on=t.sound_on,this.sound_off=t.sound_off,this.sound_src=t.sound_src,this.img_blank=t.img_blank,this.ajax_url=t.ajax_url,this.url=t.url,this.popup_url=t.popup_url,this.order=t.order,this.formato_hora=t.formato_hora,this.formato_fecha=t.formato_fecha,this.template=t.template,this.gmt=t.gmt,this.token=t.token,this.session=t.session,this.row=t.row,this.rows=t.rows,this.rowtitles=t.rowtitles,this.can_read=t.can_read,this.can_write=t.can_write,this.show_avatar=t.show_avatar,this.avatar_maxheight=t.avatar_maxheight,this.refresh_time_session=t.refresh_time_session,this.boton_enviar=t.boton_enviar,this.refresh_time=t.refresh_time,this.refresh_time_privates=t.refresh_time_privates,this.n=t.n,this.p=t.p,this.private=t.private,this.name=t.name,this.userid=t.userid,this.sound=t.sound,this.color=t.color,this.retardo=t.retardo,this.last_time=t.last_time,this.msg=t.msg,this.smilies=t.smilies,this.show_hour=t.show_hour,this.show_sessions=t.show_sessions,this.autostart=t.autostart,this.color&&this.css(this.$("CGCHAT_txt"),"color","#"+this.color),this.css(this.$("CGCHAT_users_td"),"vertical-align",this.order),t.session_gmt){var e=new Date;this.save_config("gmt",e.getTimezoneOffset()/60*-1)}t.session_retardo&&cgchat.ajax("retardo")},events:{list:[],add:function(t,e){"function"==typeof e&&(this.list[t]||(this.list[t]=[]),this.list[t].push(e))},fire:function(t,e){var s=!1;if(this.list[t]){e||(e=[]);for(var i=0;i<this.list[t].length;i++)s=this.list[t][i](e)||s}return s}}};window.addEventListener("hidden",(function(t){delete t.returnValue,cgchat.ajax("kill")})),document.addEventListener("DOMContentLoaded",(function(){options_cgchat=Joomla.getOptions("cgchat"),cgchat.options(options_cgchat)}));